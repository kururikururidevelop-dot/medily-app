# 画面コンポーネント定義書

# コンポーネント設計方針

## LIFF + LINE Messaging API 中心アーキテクチャ
* Web ベースのホーム・設定画面・回答入力画面と、LINE 内ネイティブの LIFF 質問投稿画面の組み合わせ
* 回答は Web または LINE DM 内で可能
* 医療系サービスの信頼性を反映した**優しく清潔な UI** を統一

## 一貫性
* 白＋緑＋薄グレーを基本色として、情報構造の認識コストを下げる
* LIFF と Web での色・配置の統一感を保つ

## 再利用性
* すべての UI 要素は **Auto Layout** 前提で作成
* サイズ可変（レスポンシブ）のコンポーネントを基本とする

## アクセシビリティ
* 最小タップ領域：**44px**
* コントラスト比：4.5:1以上
* 色だけで意味を持たせない

---

# コンポーネント定義一覧

## 共通コンポーネント（Web + LIFF）

| コンポーネント名 | 種別   | 説明                                       |
| ---------------- | ------ | ------------------------------------------ |
| Header           | Layout | ロゴと主要ナビゲーションを表示する上部バー |
| Footer           | Layout | サイト下部に規約・問い合わせリンクを表示   |
| TextDisplay      | Text   | 本文・見出し・補助文表示用テキスト         |
| LogoImage        | Image  | サービスロゴ表示用                         |
| FooterText       | Text   | フッター内の説明テキスト表示用             |
| OAuthButton      | Button | LINE 認証プロバイダ専用ボタン              |
| NotificationIcon | Icon   | 通知を表すアイコン                         |
| SettingsIcon     | Icon   | 設定画面遷移用アイコン                     |
| Tabs             | Nav    | マイページ内のタブ切替（新着/質問/回答）    |
| SummaryBadges    | Badge  | ホーム画面のサマリー表示（回答数/質問数/回答あり/新着あり） |

## フォーム系コンポーネント（Web + LIFF）

| コンポーネント名 | 種別    | 説明                               |
| ---------------- | ------- | ---------------------------------- |
| TextInput        | Input   | 1行のテキストを入力するフィールド  |
| PasswordInput    | Input   | 入力文字をマスク表示する入力欄     |
| MultiLineInput   | Input   | 複数行入力用テキストエリア         |
| Dropdown         | Select  | 候補から1つ選択するプルダウン      |
| Checkbox         | Control | ON/OFFを切り替えるチェックボックス |
| ToggleSwitch     | Control | 公開設定などの切替スイッチ         |
| CheckboxGroup    | Group   | 複数チェック項目をまとめたグループ |
| RadioButtonGroup | Control | ラジオボタングループ               |
| TagSelect        | Select  | カテゴリタグを選択するUI           |
| TextArea         | Input   | 複数行の自由記述入力欄（LIFF質問投稿で使用） |
| FilterPanel      | Layout  | 検索条件入力エリア                 |

## 表示系コンポーネント（Web + LIFF）

| コンポーネント名 | 種別    | 説明                                     |
| ---------------- | ------- | ---------------------------------------- |
| ProfileCard      | Card    | ユーザー基本情報をまとめて表示するカード |
| TagList          | Tag     | カテゴリ・属性の一覧表示タグ             |
| StatusBadge      | Badge   | 回答待ちなどの状態表示用ラベル           |
| QuestionCardList | List    | 質問カードの一覧表示                     |
| QuestionList     | List    | 質問一覧枠                               |
| AnswerCardList   | List    | 回答履歴カード一覧表示                   |
| MessageCardList  | List    | 回答を一覧表示（LIFF内での表示） |
| MessageCard      | Card    | 単一メッセージ表示カード（LINE DM 内容の表示） |
| ReadOnlyField    | Text    | 表示専用の単項目フィールド               |
| ReadOnlyList     | List    | 表示専用の複数項目リスト                 |
| UserProfileCard  | Card    | ユーザー情報カード表示                   |
| ContributionGraphic | Image  | 回答者の貢献度をビジュアル化して表示（街・木の成長等） |
| ThankCount       | Text    | 質問者から受け取った感謝数（サンキュー）の表示       |
| ContributionCategory | Display | 自身の主な貢献カテゴリを表示（例：皮膚科）   |
| MenuList         | List    | メニューリンク一覧                       |
| StatusMessage    | Message | 完了・成功メッセージ表示                 |
| WarningMessage   | Message | 注意・警告文表示                         |
| ScrollTextArea   | Text    | 長文表示専用スクロール領域               |

## 操作系コンポーネント（Web + LIFF）

| コンポーネント名   | 種別        | 説明                         |
| ------------------ | ----------- | ---------------------------- |
| PrimaryButton      | Button      | 主要操作用ボタン             |
| SecondaryButton    | Button      | 補助操作用ボタン             |
| DangerButton       | Button      | 破壊的・重要操作用ボタン     |
| Pagination         | Control     | ページ切り替えUI             |

---

# LINE DM / Flex Message コンポーネント実装ガイド

## 回答フロー（LINE DM 内）

### 概要
* 回答者が LINE DM 内で**回答を送信**するプロセスは、LINE Flex Message + LINE Messaging API で実装
* これらのコンポーネントは Webアプリの「画面」には表示されず、LINE Bot からの Push 通知として配信

### 質問通知（回答者向け）
* **形式**：LINE Flex Message (ButtonTemplate)
* **内容**：
  - 質問要約テキスト
  - 選択肢ボタン（ButtonComponent）

### 回答入力インターフェース（LINE DM 内）
* **形式**：LINE Flex Message (ButtonTemplate + TextBox)
* **実装**：
  - 選択肢をボタンコンポーネントで表示（タップで選択）
  - 場所情報は TextBox での自由入力
  - URL は TextBox での貼り付け対応
  - 短文（100-140文字推奨）は TextBox での自由入力
* **AI チェック**：
  - 送信前に LLM ベースの AI チェック実行
  - NGワード検出、診断行為の禁止、誹謗中傷検出
  - 違反検出時は投稿ブロック・警告メッセージ表示
* **送信**：ユーザーがボタンをタップすると、LINE Messaging API の message event を通じてシステムへ送信

### 一言・逆質問コンポーネント（LINE DM 内）
* **形式**：Line Flex Message (ButtonComponent for predefined options)
* **一言の実装**：
  - 定型文オプション（「頑張ってね」「応援しています」）をボタンで表示
  - ユーザータップで選択・確定
* **逆質問の実装**：
  - 定型逆質問文をボタンで表示
  - 選択肢から1つを選び送信

### メッセージ中継ロジック
* LINE DM 内のボタンタップ → LINE Messaging API webhook → バックエンド処理 → Firestore 保存
* 質問者への通知：Push API 使用して LINE DM へ回答内容配信
* 全てのメッセージはシステム経由で暗号化・管理

---

# Flex Message 構造例

## 質問通知テンプレート（回答者向け）
```
{
  "type": "flex",
  "altText": "新しい質問が届きました",
  "contents": {
    "type": "bubble",
    "body": {
      "type": "box",
      "layout": "vertical",
      "contents": [
        {
          "type": "text",
          "text": "質問要約",
          "weight": "bold",
          "size": "md"
        },
        {
          "type": "separator",
          "margin": "md"
        },
        {
          "type": "box",
          "layout": "vertical",
          "margin": "md",
          "spacing": "sm",
          "contents": [
            {
              "type": "button",
              "style": "link",
              "height": "sm",
              "action": {
                "type": "message",
                "label": "選択肢1",
                "text": "選択肢1を選択"
              }
            }
          ]
        }
      ]
    }
  }
}
```

---

# Web 表示系コンポーネント（MessageCard / MessageCardList）

## MessageCard（Flex Message 内容の表示）
* **用途**：LIFF の質問詳細画面（L020）で LINE DM から受け取った回答を表示
* **表示内容**：
  - 回答者の選択肢
  - 場所情報
  - URL
  - 短文コメント（100-140文字）
* **実装**：テキスト形式で構造化して表示（Markdown でも可）

## MessageCardList（複数回答の一覧）
* **用途**：LIFF 質問詳細画面（L020）で複数回答を縦スクロール表示
* **スタイル**：カード形式で各回答を視覚的に区別

---

## 貢献度グラフィック（ContributionGraphic）
* **用途**：回答者の活動を可視化し、モチベーションを向上させるダッシュボード要素
* **表示場所**：ホーム画面（A040）へ移設（旧 E020 要素）
* **関連**：ThankCount（獲得サンキュー数）、ContributionCategory（貢献カテゴリ）と組み合わせて表示

---

## AnswerCardList（回答履歴カード一覧）
* **用途**：D010｜マイページの「回答」タブで回答履歴を一覧表示
* **機能**：フィルタ（ステータス・カテゴリ）、ページネーション、ステータスバッジ表示

## QuestionCardList（質問カード一覧）
* **用途**：D010｜マイページの「新着」「質問」タブで利用
* **新着タブ**：最新の質問・ステータス更新があった質問を最大10件（新しい順）
* **質問タブ**：自身の質問一覧（フィルタ・ページネーション・ステータスバッジ）
* **表示内容（E020 フル版）**：
  - 回答数に応じた「木の成長」や「街の発展」を表すビジュアル（SVG／Canvas／画像）
  - 獲得サンキュー数（`ThankCount`）の合計表示
  - トップ貢献カテゴリ（`ContributionCategory`）の表示
  - 過去期間別の簡易グラフ（週/月）やバッジ表示
* **表示内容（L030 簡易版）**：
  - 上記の簡易表示（サマリ画像＋獲得サンキュー数）を表示し、詳細は E020 へリンク
* **実装方針**：
  - サーバで生成する画像（PNG/SVG）またはクライアント描画（Canvas/SVG）で描画
  - 更新は回答送信イベント・夜間バッチで反映し、即時性はLIFFでの簡易更新を優先
  - 画像資産のバージョニング／キャッシュ制御を考慮

---

# 今後の実装スコープ外（非対応）

## X（旧Twitter）連携
* ~~X の DM API~~ - **削除**
* ~~X ボットのメッセージ送受信~~ - **削除**


