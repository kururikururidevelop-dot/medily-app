# 実装タスク一覧 — Medily

## 目的
`docs/10_企画`／`docs/20_システム設計`／`docs/30_画面イメージ` を元に、アプリ実装のための優先順位付きタスク群を作成する。まずは MVP を明確化し、ローンチまでに必要な工程を分解・見積もりする。

---

## 参照ドキュメント
- 企画: [docs/10_企画/サービス企画書.md](docs/10_企画/サービス企画書.md)
- ペルソナ: [docs/10_企画/質問者ペルソナ.md](docs/10_企画/質問者ペルソナ.md)
- データ設計: [docs/20_システム設計/データモデル定義書.md](docs/20_システム設計/データモデル定義書.md)
- 画面定義: [docs/20_システム設計/画面定義書.md](docs/20_システム設計/画面定義書.md)
- 画面イメージ群: [docs/30_画面イメージ/](docs/30_画面イメージ/)
 - 画面コンポーネント定義: [docs/20_システム設計/画面コンポーネント定義書.md](docs/20_システム設計/画面コンポーネント定義書.md)
 - 処理方式設計書: [docs/20_システム設計/処理方式設計書.md](docs/20_システム設計/処理方式設計書.md)
 - 画面遷移設計書: [docs/20_システム設計/画面遷移設計書.md](docs/20_システム設計/画面遷移設計書.md)
 - 画面ガイドライン・共通仕様: [docs/20_システム設計/画面ガイドライン・共通仕様.md](docs/20_システム設計/画面ガイドライン・共通仕様.md)

---

## 要件（要約）
- 質問は LIFF 経由で投稿され、LINE のマルチキャストで回答候補者に通知する。マッチングは地域 × カテゴリ等で行う。回答は 1 対 1 の個別スレッドへ移行し、ラリー回数などで自動クローズする。
- データベースは Firestore（ドキュメントモデル）を想定。`users`, `questions`, `answers`, `threads`, `contributions` 等を用いる。
- モック（Web: PRサイト、各種PC/モバイルページ）を元に UI 実装。まずは主要画面（PR、OAuth、プロフィール登録、ホーム、質問一覧、LIFF 質問投稿/詳細、マイページ、設定、退会）を整備する。
- セキュリティ（最小権限）・非機能（スケール、バッチ処理、監査）について設計済み。LINE API と連携するための実装が必要。

---

## スコープ
### MVP（ローンチ必須）
1. 質問投稿(LIFF) — フォーム、テンプレ、地域選択、公開設定
2. 回答の受信・マッチング — マルチキャスト通知（LINE API mock での代替可）
3. 回答投稿 — 回答テンプレ・短文・AIフィルタ連携（初期は簡易チェック）
4. 個別スレッド（質問者 ↔ 回答者） — ラリー制御（例：3往復）
5. プロフィール登録・編集（ニックネーム、地域、カテゴリ）
6. PRサイト（A010） + OAuth 選択ページ（A020） + 初回登録（A030）
7. 基本データモデル（Firestore）とセキュリティルールの初期版
8. ロギング／監査（重要イベントの保存）

### ローンチ後（優先度高）
- 回答者貢献のグラフィカル実装（木/葉の表現、E020用画像生成）
- エスカレーション（リトライ）・自動クローズ バッチ/スケジューラ
- 詳細な AI チェック（LLM API 統合・運用ルール）
- モニタリング・コスト管理（通知最適化）

### 交換可能 / 後回し
- 高度な UI アニメーション（最初は簡易）
- 多言語対応
- 広告／課金機能

---

## 実装タスク（カテゴリ別・優先順）
各タスクは**説明 / 成果物 / 受け入れ条件 / 見積（工数）** を含む。見積はラフ（人日）で、詳細は別途分割。

### A. インフラ & プロジェクト設定（必須）
- A1: プロジェクト初期構成（1d）
  - 説明: Firebase プロジェクト・Firestore・Cloud Functions 設定、Vercel（またはホスティング）設定、環境変数管理
  - 成果物: `firebase` プロジェクト設定、`.env.example`、デプロイ手順
  - 受け入れ: Firestore に接続できるデプロイ手順が確認できる

- A2: CI/CD 設定（1d）
  - 説明: ビルド、lint、テスト（E2Eはオプション）を自動化
  - 成果物: GitHub Actions または同等パイプライン
  - 受け入れ: PR マージ前にビルドが通ること

### B. 認証・登録（必須）
- B1: LINE OAuth / ラップ (2d)
  - 成果物: OAuth フローを呼べるエンドポイント、テスト用モック
  - 受け入れ: ログイン→初回プロフィールフローが動作

- B2: 初回プロフィール登録（A030） (1d)
  - 成果物: 登録 UI + バリデーション、Firestore にプロファイル登録
  - 受け入れ: 必須項目（ニックネーム、地域）が登録される

### C. 質問・回答ワークフロー（MVP中核）
- C1: 質問投稿（LIFF L010/L011/L012）(3d)
  - 説明: フォーム、テンプレ選択、公開設定、投稿 API
  - 成果物: LIFF フロント + Cloud Function / API エンドポイント
  - 受け入れ: 質問が `questions` コレクションに保存される

- C2: マッチング & マルチキャスト通知（2d）
  - 説明: 地域×カテゴリで候補抽出、LINE マルチキャスト送信（最初はログ出力モード）
  - 成果物: Notification function、通知試験レポート
  - 受け入れ: 指定ユーザーに通知が送られる（モックでOK）

- C3: 回答投稿（questions/{id}/answers）(2d)
  - 成果物: 回答保存 + `answerCount` インクリメント（トランザクション）、AI チェックのフック
  - 受け入れ: 回答が保存され、`questions.answerCount` が更新される

- C4: スレッド管理（threads）(2d)
  - 成果物: `threads` コレクション、ラリー制御（3往復制限）の実装
  - 受け入れ: ラリー上限に達すると自動でスレッドがクローズされる

### D. UI 実装（Web + LIFF）
- D1: PRサイト（A010） & OAuth 選択（A020） (2d)
- D2: ホーム (A040) / 質問一覧 (A041) (3d)
- D3: マイページ (D010) / プロフィール編集 (D020) (2d)
- D4: 回答一覧 (E020) / 貢献グラフィック (簡易) (3d)
- D5: 設定 / 退会 (F010/F040) (1d)

受け入れ条件: 各ページがレスポンシブに表示され、主要ユースケース（投稿 → 通知 → 回答 → スレッド）が UI 上でたどれること

### E. 非機能・運用（並行）
- E1: セキュリティルール（Firestore）(1d)
- E2: バックアップ・エクスポート設定(0.5d)
- E3: 自動クローズ・エスカレーションのバッチ（Cloud Scheduler + Cloud Functions）(2d)
- E4: ログ・監査（audits collection）(1d)

---

## 優先度とマイルストーン案（2週間スプリント基準）
- Sprint 0: 環境構築 (A1, A2) — 週1
- Sprint 1: 認証 + 初回登録 (B1, B2) — 週2
- Sprint 2: 質問投稿 + マッチング (C1, C2) — 週3
- Sprint 3: 回答投稿 + スレッド管理 (C3, C4) — 週4
- Sprint 4: UI 仕上げ・モニタリング (D*, E*) — 週5

---

## リスクと軽減策
- LINE Messaging API の制限・課金: モック運用→LINE テスト環境→逐次本番連携に移行
- 個人情報 / 医療情報の取り扱い: 最小権限・監査ログ・データ保持ポリシーを厳格に適用
- 大量通知によるコスト: 通知のサンプリング・エスカレーションで抑制

---

## 次のアクション（私が行うこと）
1. このタスク文書を `docs/40_実装/実装タスク.md` として作成しました（ドラフト）。
2. 必要ならタスクをさらに細分化して GitHub Issues に移行します（希望があれば実施）。
3. 優先度やスプリント割り当ての確認をお願いします。

---

必要なら優先順の微調整・見積りの詳細分割（チケット化）まで進めます。どこから着手しましょうか？
